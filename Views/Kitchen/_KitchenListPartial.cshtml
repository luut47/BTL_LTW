@model List<BTL_LTW.Models.Order>

@if (Model == null || !Model.Any())
{
    <div class="text-muted">Không có order nào đang xử lý.</div>
}
else
{
    @foreach (var o in Model.OrderByDescending(x => x.CreatedAt))
    {
        <div style="border:1px solid #ccc;padding:8px;margin-bottom:10px;">
            <div>
                <strong>Order:</strong> @o.Id
                &nbsp; - &nbsp; <strong>Mã đơn:</strong> @o.TableToken
                &nbsp; - &nbsp; <strong>@o.Status</strong>
            </div>
            <div>Created: @o.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd HH:mm:ss")</div>

            <ul style="margin-top:6px;">
                @foreach (var it in o.Items)
                {
                    <li style="margin:6px 0;">
                        @it.MenuItemName - x@it.Qty -
                        <span id="status-@o.Id-@it.MenuItemId">@it.Status</span>
                        <button onclick="updateStatus('@o.Id', @it.MenuItemId, 'Preparing')">Start</button>
                        <button onclick="updateStatus('@o.Id', @it.MenuItemId, 'Served')">Done</button>

                        <!-- progress bar nhỏ -->
                        @{
                            var pct = it.Status.ToString() switch
                            {
                                "Pending" => 25,
                                "Preparing" => 50,
                                "Ready" => 75,
                                "Served" => 100,
                                "Cancelled" => 100,
                                _ => 0
                            };
                        }
                        <div class="progress" style="height:6px;max-width:260px;margin-top:4px;">
                            <div class="progress-bar" role="progressbar" style="width:@pct%"></div>
                        </div>
                    </li>
                }
            </ul>
        </div>
        <strong>Order:</strong>
 
        @o.Id
        @if (o.IsTakeAway)
        {
            <span class="badge bg-info ms-2">Mang về</span>
        }

    }
}

